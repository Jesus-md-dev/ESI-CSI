package es.uca.gii.csi20.mdj.gui;

import javax.swing.JInternalFrame;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JTextField;
import javax.swing.SwingConstants;

import es.uca.gii.csi20.mdj.data.Caso;

import javax.swing.JButton;
import java.awt.event.ActionListener;
import java.awt.event.ActionEvent;

public class IfrCaso extends JInternalFrame {
	/**
	 * 
	 */
	private static final long serialVersionUID = 1L;
	private JTextField txtTitulo;
	private JTextField txtDescripcion;
	private JTextField txtImportancia;
	private Caso _cCaso = null;


	/**
	 * Create the frame.
	 */
	public IfrCaso(Caso cCaso) {
		setResizable(true);
		setClosable(true);
		setTitle("Caso");
		setBounds(100, 100, 450, 300);
		getContentPane().setLayout(null);
		
		JLabel lblTitulo = new JLabel("Titulo");
		lblTitulo.setBounds(10, 11, 46, 14);
		getContentPane().add(lblTitulo);
		
		txtTitulo = new JTextField();
		txtTitulo.setBounds(81, 8, 180, 20);
		getContentPane().add(txtTitulo);
		txtTitulo.setColumns(10);
		
		txtDescripcion = new JTextField();
		txtDescripcion.setBounds(81, 39, 180, 20);
		getContentPane().add(txtDescripcion);
		txtDescripcion.setColumns(10);
		
		txtImportancia = new JTextField();
		txtImportancia.setBounds(81, 70, 180, 20);
		getContentPane().add(txtImportancia);
		txtImportancia.setColumns(10);
		
		JLabel lblDescripcion = new JLabel("Descripcion");
		lblDescripcion.setVerticalAlignment(SwingConstants.BOTTOM);
		lblDescripcion.setBounds(10, 42, 61, 14);
		getContentPane().add(lblDescripcion);
		
		JLabel lblImportancia = new JLabel("Importancia");
		lblImportancia.setBounds(10, 73, 61, 14);
		getContentPane().add(lblImportancia);
		
		_cCaso = cCaso;
		if( _cCaso != null) {
			txtTitulo.setText(_cCaso.getTitulo());
			txtDescripcion.setText(_cCaso.getDescripcion());
			txtImportancia.setText(Integer.toString(_cCaso.getImportancia()));
		}
		
		JButton butSave = new JButton("Guardar");
		butSave.addActionListener(new ActionListener() {
			public void actionPerformed(ActionEvent e) {
				try {
					
					if(txtTitulo.getText().isEmpty())
						throw new IllegalStateException("Título Vacio");
					if(txtDescripcion.getText().isEmpty())
						throw new IllegalStateException("Descripción Vacia");
					if(txtImportancia.getText().isEmpty())
						throw new IllegalStateException("Importancia Vacia");
					
					if(_cCaso == null)
						_cCaso = Caso.Create(txtTitulo.getText(), txtDescripcion.getText(), Integer.parseInt(txtImportancia.getText()));
					else {
						_cCaso.setTitulo(txtTitulo.getText());
						_cCaso.setDescripcion(txtDescripcion.getText());
						_cCaso.setImportancia(Integer.parseInt(txtImportancia.getText()));
						_cCaso.Update();
					}
				} catch(IllegalStateException ex) {
					JOptionPane.showMessageDialog(null, ex.getMessage() ,"Error", JOptionPane.ERROR_MESSAGE);
				} catch (NumberFormatException ex) {
					JOptionPane.showMessageDialog(null, "Se ha introducido un valor no numérico\n " + ex.getMessage() ,"Error", JOptionPane.ERROR_MESSAGE);
				} catch (Exception ex) { 
					JOptionPane.showMessageDialog(null, ex.getMessage() ,"Error", JOptionPane.ERROR_MESSAGE);
				}
				
			}
		});
		butSave.setBounds(78, 101, 89, 23);
		getContentPane().add(butSave);
	}
}
